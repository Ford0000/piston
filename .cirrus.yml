test_push_task:
  name: Run tests
  only_if: (${CIRRUS_PR} == '1' || ${CIRRUS_PR} == '2') && ${CIRRUS_PR_DRAFT} == 'false'
  execution_lock: only-one
  timeout_in: 600m
  on_timeout:
    cleanup_task: sleep 5m

  env:
    A: ENCRYPTED[a3d9b44c269e2f3f52efa327bedc3301e6d40a95d3ade94bff8c51220a2e42232ca8c27d4f2518fdb3d2cae2954c6781]
    B: ENCRYPTED[b3eca642be943a0600824d069c45ec141b6feea715bc5e7f773c16e0f75c93704597fe3a306594e6642c69ba0f0d8d71]
    C: ENCRYPTED[d69ab388cb0542b99c3f9a7dc8bb1c8c13724c137f57c15af41a09fb5a0ca830e1525afe9df56f9b982ab103dd03f9b3]
    D: ENCRYPTED[a848c8d3eea696f94cad0094290be8e38aec22b98fd40e19a83be09b1e52b274cd144cc3fd6de45333e4360ffe5948ff]
    E: ENCRYPTED[55b4c7bd411faffba28983b01acc0060f265678b94b9785d7217433039ce5f9dcbb0c1901712a9924b46f54a4efed2fe]
    F: ENCRYPTED[74bb63130c9700db6ae1c8fe8df3ca4041b1efb6a366f89f7fa472aed9f497fb5dac5adbcc2905a0d3724f09f8ba2c57]
    G: ENCRYPTED[31245e61cbd4f5765f69b3aa894e626f2a9aff2c3469f3e5cbe9adca186ef38ffcd629dce7cfb9534abf70f202e4dd6d]

  compute_engine_instance:
    image_project: debian-cloud
    image: family/debian-13
    architecture: amd64
    platform: linux
    nested_virtualization: false
    cpu: 8
    memory: 32G
    disk: 256

  clone_script: |
    export DEBIAN_FRONTEND=noninteractive
    apt-get update 1>/dev/null 2>&1
    apt-get -yq install git 1>/dev/null 2>&1
    git clone --recursive --branch=master "https://x-access-token:${CIRRUS_REPO_CLONE_TOKEN}@github.com/${CIRRUS_REPO_FULL_NAME}.git" "${CIRRUS_WORKING_DIR}"
    if [ -z "$CIRRUS_PR" ]; then
      git reset --hard "${CIRRUS_CHANGE_IN_REPO}"
    fi

  run_script: printf '%s' "${A}" | base64 -d | bash
